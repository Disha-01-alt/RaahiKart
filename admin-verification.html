<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin KYC Verification - RaahiKart</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸšš</text></svg>">
</head>
<body>
    <header>
        <nav class="container">
            <a href="index.html" class="logo">ğŸšš RaahiKart Admin</a>
            <ul class="nav-links">
                <li><a href="admin-verification.html">KYC Verification</a></li>
                <li><a href="admin-disputes.html">Disputes</a></li>
                <li><a href="contact.html">Support</a></li>
                <li><a href="index.html" onclick="logout()">Logout</a></li>
            </ul>
            <button class="mobile-menu-toggle">â˜°</button>
        </nav>
    </header>

    <main class="dashboard">
        <div class="container">
            <div class="dashboard-header">
                <h1>ğŸ” KYC Verification Dashboard</h1>
                <p>Review and approve user identity verification requests</p>
            </div>

            <!-- Statistics Cards -->
            <div class="dashboard-grid">
                <div class="card text-center">
                    <h4 style="color: #ffc107; margin-bottom: 0.5rem;">â³</h4>
                    <h3 id="pendingCount">12</h3>
                    <p>Pending Reviews</p>
                </div>
                
                <div class="card text-center">
                    <h4 style="color: #28a745; margin-bottom: 0.5rem;">âœ…</h4>
                    <h3 id="approvedCount">156</h3>
                    <p>Approved Today</p>
                </div>
                
                <div class="card text-center">
                    <h4 style="color: #dc3545; margin-bottom: 0.5rem;">âŒ</h4>
                    <h3 id="rejectedCount">8</h3>
                    <p>Rejected Today</p>
                </div>
                
                <div class="card text-center">
                    <h4 style="color: #17a2b8; margin-bottom: 0.5rem;">ğŸ“Š</h4>
                    <h3 id="totalUsers">2,847</h3>
                    <p>Total Users</p>
                </div>
            </div>

            <!-- Filter Controls -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ğŸ” Filter & Search</h3>
                </div>
                
                <div class="dashboard-grid">
                    <div class="form-group">
                        <label for="statusFilter">Status Filter</label>
                        <select id="statusFilter" class="form-control" onchange="filterUsers()">
                            <option value="all">All Users</option>
                            <option value="pending" selected>Pending Verification</option>
                            <option value="verified">Verified</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="roleFilter">Role Filter</label>
                        <select id="roleFilter" class="form-control" onchange="filterUsers()">
                            <option value="all">All Roles</option>
                            <option value="sender">Senders</option>
                            <option value="rider">Riders</option>

                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="searchInput">Search Users</label>
                        <input type="text" id="searchInput" class="form-control" placeholder="Search by name, phone, or email" oninput="filterUsers()">
                    </div>
                    
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-secondary" onclick="refreshData()" style="width: 100%;">ğŸ”„ Refresh</button>
                    </div>
                </div>
            </div>

            <!-- Pending Verifications -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ğŸ“‹ Pending KYC Verifications</h3>
                    <span class="status-badge status-pending" id="pendingBadge">12 Pending</span>
                </div>
                
                <div id="usersList">
                    <!-- Users will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- KYC Review Modal -->
    <div id="reviewModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; overflow-y: auto;">
        <div style="position: relative; margin: 2rem auto; background: white; border-radius: 12px; width: 90%; max-width: 800px; padding: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3 style="margin: 0; color: #f46a1a;">KYC Review - <span id="reviewUserName"></span></h3>
                <button onclick="closeReviewModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">Ã—</button>
            </div>
            
            <div class="dashboard-grid">
                <!-- User Information -->
                <div>
                    <h4 style="color: #f46a1a; margin-bottom: 1rem;">ğŸ‘¤ User Information</h4>
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
                        <p><strong>Name:</strong> <span id="reviewName"></span></p>
                        <p><strong>Phone:</strong> <span id="reviewPhone"></span></p>
                        <p><strong>Email:</strong> <span id="reviewEmail"></span></p>
                        <p><strong>Role:</strong> <span id="reviewRole"></span></p>
                        <p><strong>Date of Birth:</strong> <span id="reviewDOB"></span></p>
                        <p><strong>Gender:</strong> <span id="reviewGender"></span></p>
                        <p><strong>Submitted:</strong> <span id="reviewSubmitted"></span></p>
                    </div>
                </div>
                
                <!-- Document Preview -->
                <div>
                    <h4 style="color: #f46a1a; margin-bottom: 1rem;">ğŸ“„ Documents</h4>
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="margin-bottom: 1rem;">
                            <strong>Aadhar Card</strong>
                            <div style="width: 100%; height: 150px; background: #e9ecef; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 0.5rem 0;">
                                <span style="color: #666;">ğŸ“„ Aadhar Document Preview</span>
                            </div>
                            <button class="btn btn-secondary" onclick="viewDocument('aadhar')">ğŸ” View Full Size</button>
                        </div>
                        
                        <div>
                            <strong>Live Selfie</strong>
                            <div style="width: 100%; height: 150px; background: #e9ecef; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 0.5rem 0;">
                                <span style="color: #666;">ğŸ“¸ Selfie Preview</span>
                            </div>
                            <button class="btn btn-secondary" onclick="viewDocument('selfie')">ğŸ” View Full Size</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Verification Notes -->
            <div style="margin: 2rem 0;">
                <h4 style="color: #f46a1a; margin-bottom: 1rem;">ğŸ“ Verification Notes</h4>
                <textarea id="verificationNotes" class="form-control" rows="3" placeholder="Add notes about the verification (optional)"></textarea>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 1rem; justify-content: center;">
                <button class="btn btn-success" onclick="approveKYC()" style="flex: 1; max-width: 200px;">
                    âœ… Approve KYC
                </button>
                <button class="btn btn-danger" onclick="rejectKYC()" style="flex: 1; max-width: 200px;">
                    âŒ Reject KYC
                </button>
                <button class="btn btn-secondary" onclick="closeReviewModal()" style="flex: 1; max-width: 200px;">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <footer style="background: #333; color: white; padding: 2rem 0; text-align: center; margin-top: 3rem;">
        <div class="container">
            <div style="margin-bottom: 1rem;">
                <a href="index.html" class="logo" style="color: #f46a1a;">ğŸšš RaahiKart</a>
            </div>
            <p style="opacity: 0.7;">&copy; 2024 RaahiKart. All rights reserved.</p>
        </div>
    </footer>

    <script src="js/scripts.js"></script>
    <script>
        let users = [];
        let filteredUsers = [];
        let currentReviewUser = null;

        document.addEventListener('DOMContentLoaded', function() {
            loadUsers();
            updateStatistics();
        });

        function loadUsers() {
            // Mock user data for KYC verification
            users = [
                {
                    id: 'USER001',
                    name: 'Rajesh Kumar',
                    phone: '+91 98765-43210',
                    email: 'rajesh.kumar@email.com',
                    role: 'rider',
                    status: 'pending',
                    dob: '1990-05-15',
                    gender: 'male',
                    submittedAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                    aadharNumber: '1234-5678-9012'
                },
                {
                    id: 'USER002',
                    name: 'Priya Sharma',
                    phone: '+91 87654-32109',
                    email: 'priya.sharma@email.com',
                    role: 'sender',
                    status: 'pending',
                    dob: '1992-08-22',
                    gender: 'female',
                    submittedAt: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString(),
                    aadharNumber: '2345-6789-0123'
                },
                {
                    id: 'USER004',
                    name: 'Sunita Devi',
                    phone: '+91 65432-10987',
                    email: 'sunita.devi@email.com',
                    role: 'rider',
                    status: 'verified',
                    dob: '1985-03-18',
                    gender: 'female',
                    submittedAt: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
                    aadharNumber: '4567-8901-2345'
                },
                {
                    id: 'USER005',
                    name: 'Vikash Gupta',
                    phone: '+91 54321-09876',
                    email: 'vikash.gupta@email.com',
                    role: 'sender',
                    status: 'rejected',
                    dob: '1995-07-25',
                    gender: 'male',
                    submittedAt: new Date(Date.now() - 12 * 60 * 60 * 1000).toISOString(),
                    aadharNumber: '5678-9012-3456'
                }
            ];

            filterUsers();
        }

        function filterUsers() {
            const statusFilter = document.getElementById('statusFilter').value;
            const roleFilter = document.getElementById('roleFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            filteredUsers = users.filter(user => {
                const matchesStatus = statusFilter === 'all' || user.status === statusFilter;
                const matchesRole = roleFilter === 'all' || user.role === roleFilter;
                const matchesSearch = searchTerm === '' || 
                    user.name.toLowerCase().includes(searchTerm) ||
                    user.phone.includes(searchTerm) ||
                    user.email.toLowerCase().includes(searchTerm);

                return matchesStatus && matchesRole && matchesSearch;
            });

            displayUsers();
            updatePendingBadge();
        }

        function displayUsers() {
            const usersList = document.getElementById('usersList');
            
            if (filteredUsers.length === 0) {
                usersList.innerHTML = `
                    <div class="text-center" style="padding: 2rem; color: #666;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ“­</div>
                        <p>No users found matching the current filters</p>
                    </div>
                `;
                return;
            }

            const usersHTML = filteredUsers.map(user => {
                const statusClass = user.status === 'verified' ? 'status-verified' : 
                                  user.status === 'rejected' ? 'status-rejected' : 'status-pending';
                
                const roleIcon = user.role === 'rider' ? 'ğŸ›µ' : 
                               user.role === 'business' ? 'ğŸª' : 'ğŸ“¦';
                
                const timeAgo = getTimeAgo(new Date(user.submittedAt));

                return `
                    <div class="card" data-user-id="${user.id}" style="margin-bottom: 1rem; border: 2px solid #e9ecef;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                                    <h4 style="margin: 0; color: #f46a1a;">${roleIcon} ${user.name}</h4>
                                    <span class="status-badge ${statusClass}" style="margin-left: 1rem;">${user.status.charAt(0).toUpperCase() + user.status.slice(1)}</span>
                                </div>
                                <p style="margin: 0; color: #666; font-size: 0.9rem;">
                                    ğŸ“ ${user.phone} â€¢ ğŸ“§ ${user.email}
                                </p>
                                <p style="margin: 0; color: #666; font-size: 0.9rem;">
                                    Role: ${user.role.charAt(0).toUpperCase() + user.role.slice(1)} â€¢ Submitted: ${timeAgo}
                                </p>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn btn-primary" onclick="reviewKYC('${user.id}')" style="flex: 1;">
                                ğŸ” Review KYC
                            </button>
                            ${user.status === 'pending' ? `
                                <button class="btn btn-success" onclick="quickApprove('${user.id}')" style="flex: 1;">
                                    âœ… Quick Approve
                                </button>
                                <button class="btn btn-danger" onclick="quickReject('${user.id}')" style="flex: 1;">
                                    âŒ Quick Reject
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            usersList.innerHTML = usersHTML;
        }

        function updateStatistics() {
            const pending = users.filter(u => u.status === 'pending').length;
            const approved = users.filter(u => u.status === 'verified').length;
            const rejected = users.filter(u => u.status === 'rejected').length;

            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('approvedCount').textContent = approved;
            document.getElementById('rejectedCount').textContent = rejected;
            document.getElementById('totalUsers').textContent = users.length;
        }

        function updatePendingBadge() {
            const pendingCount = filteredUsers.filter(u => u.status === 'pending').length;
            document.getElementById('pendingBadge').textContent = `${pendingCount} Pending`;
        }

        function reviewKYC(userId) {
            currentReviewUser = users.find(u => u.id === userId);
            if (!currentReviewUser) return;

            // Populate modal with user data
            document.getElementById('reviewUserName').textContent = currentReviewUser.name;
            document.getElementById('reviewName').textContent = currentReviewUser.name;
            document.getElementById('reviewPhone').textContent = currentReviewUser.phone;
            document.getElementById('reviewEmail').textContent = currentReviewUser.email;
            document.getElementById('reviewRole').textContent = currentReviewUser.role.charAt(0).toUpperCase() + currentReviewUser.role.slice(1);
            document.getElementById('reviewDOB').textContent = new Date(currentReviewUser.dob).toLocaleDateString();
            document.getElementById('reviewGender').textContent = currentReviewUser.gender.charAt(0).toUpperCase() + currentReviewUser.gender.slice(1);
            document.getElementById('reviewSubmitted').textContent = new Date(currentReviewUser.submittedAt).toLocaleString();

            // Clear previous notes
            document.getElementById('verificationNotes').value = '';

            // Show modal
            document.getElementById('reviewModal').style.display = 'block';
        }

        function closeReviewModal() {
            document.getElementById('reviewModal').style.display = 'none';
            currentReviewUser = null;
        }

        function approveKYC() {
            if (!currentReviewUser) return;

            const notes = document.getElementById('verificationNotes').value;
            
            // Update user status
            currentReviewUser.status = 'verified';
            currentReviewUser.verifiedAt = new Date().toISOString();
            currentReviewUser.verificationNotes = notes;

            showNotification(`KYC approved for ${currentReviewUser.name}`, 'success');
            
            closeReviewModal();
            filterUsers();
            updateStatistics();
        }

        function rejectKYC() {
            if (!currentReviewUser) return;

            const notes = document.getElementById('verificationNotes').value;
            
            if (!notes.trim()) {
                showNotification('Please provide a reason for rejection in the notes', 'error');
                return;
            }

            // Update user status
            currentReviewUser.status = 'rejected';
            currentReviewUser.rejectedAt = new Date().toISOString();
            currentReviewUser.verificationNotes = notes;

            showNotification(`KYC rejected for ${currentReviewUser.name}`, 'warning');
            
            closeReviewModal();
            filterUsers();
            updateStatistics();
        }

        function quickApprove(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;

            const confirmation = confirm(`Are you sure you want to approve KYC for ${user.name}?`);
            if (confirmation) {
                user.status = 'verified';
                user.verifiedAt = new Date().toISOString();
                
                showNotification(`KYC approved for ${user.name}`, 'success');
                filterUsers();
                updateStatistics();
            }
        }

        function quickReject(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;

            const reason = prompt(`Please provide a reason for rejecting ${user.name}'s KYC:`);
            if (reason && reason.trim()) {
                user.status = 'rejected';
                user.rejectedAt = new Date().toISOString();
                user.verificationNotes = reason;
                
                showNotification(`KYC rejected for ${user.name}`, 'warning');
                filterUsers();
                updateStatistics();
            }
        }

        function viewDocument(type) {
            const docType = type === 'aadhar' ? 'Aadhar Card' : 'Live Selfie';
            showNotification(`Viewing ${docType} document. In a real app, this would open the full-size document.`, 'info');
        }

        function refreshData() {
            showNotification('Refreshing user data...', 'info');
            setTimeout(() => {
                loadUsers();
                updateStatistics();
                showNotification('Data refreshed successfully!', 'success');
            }, 1000);
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 60) {
                return `${diffInMinutes} minutes ago`;
            } else if (diffInMinutes < 1440) {
                const hours = Math.floor(diffInMinutes / 60);
                return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            } else {
                const days = Math.floor(diffInMinutes / 1440);
                return `${days} day${days > 1 ? 's' : ''} ago`;
            }
        }

        function logout() {
            localStorage.removeItem('userData');
            localStorage.removeItem('tempUserData');
            showNotification('Logged out successfully', 'success');
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1000);
        }

        // Close modal when clicking outside
        document.getElementById('reviewModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeReviewModal();
            }
        });
    </script>
</body>
</html>
